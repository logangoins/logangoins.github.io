# Forest
Forest is an easy machine on the HacktheBox platform, primarily specializing in Active Directory exploitation. This machine was on TJNull's OSCP list and helped me pass the OSCP exam.

### Enumeration
We start off with a nmap scan, using default scripts (-sC), and the enumerating versions flags (-sV).
```
Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-12-12 08:29 CST
WARNING: No targets were specified, so 0 hosts scanned.
Nmap done: 0 IP addresses (0 hosts up) scanned in 0.45 seconds
                                                                                                                                                                                             
shellph1sh@kali:~/Htb/forest$ sudo nmap -p 53,88,135,139,389,445,464,593,636,3269,5985,9389,47001 -sC -sV -oA nmap/forest 10.10.10.161
Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-12-12 08:29 CST
Nmap scan report for 10.10.10.161
Host is up (0.061s latency).

PORT      STATE SERVICE      VERSION
53/tcp    open  domain       Simple DNS Plus
88/tcp    open  kerberos-sec Microsoft Windows Kerberos (server time: 2023-12-12 14:36:32Z)
135/tcp   open  msrpc        Microsoft Windows RPC
139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn
389/tcp   open  ldap         Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds (workgroup: HTB)
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http   Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3269/tcp  open  tcpwrapped
5985/tcp  open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp  open  mc-nmf       .NET Message Framing
47001/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
Service Info: Host: FOREST; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb-os-discovery: 
|   OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3)
|   Computer name: FOREST
|   NetBIOS computer name: FOREST\x00
|   Domain name: htb.local
|   Forest name: htb.local
|   FQDN: FOREST.htb.local
|_  System time: 2023-12-12T06:36:42-08:00
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled and required
|_clock-skew: mean: 2h46m39s, deviation: 4h37m09s, median: 6m37s
| smb2-time: 
|   date: 2023-12-12T14:36:39
|_  start_date: 2023-12-11T01:44:33
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: required

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 24.32 seconds
```



By this nmap scan, we can see that that this machine is an Active Directory Domain Controller. We can attempt to enumerate Domain user accounts if SMB anonymous bindings are enabled. So we run `enum4linux`.

![image](https://github.com/shellph1sh/shellph1sh.github.io/assets/55106700/914fb276-0b73-4bce-bb94-479c8cbbb499)

We aquire quite a few users from `enum4linux`, which we can use to leverage an attack.

### Exploitation
We can build a wordlist of Domain usernames to test if accounts are ASREP-Roastable. An ASREPRoasting attack leverages an accounts lack of Kerberos pre-authentication required, giving us the users hash.

We can build the text file users.txt like so:
```
sebastien
lucinda
svc-alfresco
andy
mark
santi
zeus
```

and utilize it in an ASREPRoasting attack with `impacket-GetNPUsers`:
![image](https://github.com/shellph1sh/shellph1sh.github.io/assets/55106700/e427e5ec-d449-4685-b33a-39834459c515)



We get a hash for the user svc-alfresco! The naming convention `svc` indicates a service account, meaning potentially more privilege being given to this account.

We can then attempt to crack the hash using hashcat, with the command: `hashcat -m 18200 hash.txt /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule`:

![image](https://github.com/shellph1sh/shellph1sh.github.io/assets/55106700/89e74388-986f-48b6-9e95-cca47192b952)


Boom! We cracked the service account hash!




